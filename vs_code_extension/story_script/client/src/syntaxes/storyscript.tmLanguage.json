{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "StoryScript",
	"scopeName": "source.storyscript",
	"patterns": [
		{
			"include": "#comment-line"
		},
		{
			"include": "#storyScript"
		}
	],
	
	"repository": {
		
		"storyScript": {
			"patterns": [
				{
					"include": "#code-line"
				}
			]
		},

		"comment-line": {
			"patterns": [
				{
					"name": "comment",
					"match": "//.*$"
				}
			]
		},

		"code-line": {
			"patterns": [
				{
					"include": "#comment-line"
				},
				{
					"include": "#item-line"
				},
				{
					"include": "#text-line"
				}
			]
		},

		"item-line": {
			"patterns": [{
				"match": "^\\s*(\\*)\\s(\\b\\w+\\b):(.*)?",
				"captures": {
					"1": {
						"name": "constant"
					},
					"2": {
						"patterns": [{
							"include": "#item-name"
						}]
					},
					"3": {
						"patterns": [{
							"include": "#item-type"
						}]
					}
				}
			}]
		},
		
		"text-line": {
			"patterns": [
				{
					"match": "@[\\w\\.]+\\b",
					"name": "variable.name"
				}
			]
		},
		
		"invalid": {
			"patterns": [
				{
					"name": "invalid.illegal",
					"match": ".+?(?=//)"
				}
			]
		},
		
		"array-brackets": {
			"patterns": [
				{
					"match": "(\\[)(\\d+)*?(\\])",
					"captures": {
						"1": {
							"name": "constant"
						},
						"2": {
							"patterns": [
								{
									"include": "#digit"
								}
							]
						},
						"3": {
							"name": "constant"
						}
					}
				}
			]
		},

		"keywords": {
			"patterns": [
				{
					"name": "keyword",
					"match": "\\b(true|false|функция)\\b"
				}
			]
		},

		"comment-or-invalid": {
			"patterns": [
				{
					"include": "#comment-line"
				},
				{
					"include": "#invalid"
				}
			]
		},

		"function-signature": {
			"patterns": [
				{
					"match": "(\\()(.+?)(\\))",
					"captures": {
						"1": {
							"name": "support.function"
						},
						"3": {
							"name": "support.function"
						},
						"2": {
							"patterns": [
								{
									"match": "(\\b\\w+\\b):?(\\b\\w+\\b)?",
									"captures": {
										"1": {
											"name": "constant.name"
										},
										"2": {
											"name": "support.type"
										}
									}
								}
							]
						}
					}
				}
			]
		},

		"item-name": {
			"patterns": [
				{
					"name": "entity.name",
					"match": ".*"
				}
			]
		},
		"item-type": {
			"patterns": [
				{
					"match": ".*",
					"name": "support.type"
				}
			]
		},
		

		"digit": {
			"patterns": [
				{
					"name": "constant.numeric",
					"match": "\\d+"
				}
			]
		}

	}

}